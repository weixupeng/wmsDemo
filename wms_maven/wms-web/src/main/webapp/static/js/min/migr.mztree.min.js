(function($){$.fn.extend({mztree:function($p){return this.each(function(){var $this=$(this);var idKey=$this.attr("idKey")||"code";var callback=$this.attr("callback");callback=callback||function(event,treeId,treeNode,clickFlag){var reloadAct=$this.attr("reloadAct")||"navTab";var reloadUrl=$this.attr("reloadUrl");var reloadParamName=$this.attr("reloadParamName")||$this.attr("pName")||"parentCode";var reloadDialogId=$this.attr("reloadDialogId");var data={};data[reloadParamName]=treeNode[idKey];if("dialog"==reloadAct){jQuery.pdialog.reload(reloadUrl,{dialogId:reloadDialogId,data:data});}else{navTab.reload(reloadUrl,{navTabId:reloadDialogId,fresh:true,data:data});}};if(!$.isFunction(callback))callback=eval('('+callback+')');var op={id:$this.attr("id"),idKey:idKey,pIdKey:$this.attr("pIdKey")||"parent",rootPId:$this.attr("rootPId")||"0",data:Bird.jsonEval($($this.attr("dataInput")||"#treeString",$p).text()),selectNode:$this.attr("selectNode"),callback:callback,dblClickExpand:$this.attr("dblClickExpand")||false,selectedMulti:$this.attr("selectedMulti")||false,kName:$this.attr("kName")||"name",kTitle:$this.attr("kTitle")||"name"};var setting={view:{dblClickExpand:op.dblClickExpand,selectedMulti:op.selectedMulti},data:{key:{name:op.kName,title:op.kTitle},simpleData:{enable:true,idKey:op.idKey,pIdKey:op.pIdKey,rootPId:op.rootPId}},callback:{beforeAsync:function(treeId,treeNode){return treeNode?treeNode.level<1:true;},onClick:op.callback}};$.fn.zTree.init($this,setting,op.data);var zTree=$.fn.zTree.getZTreeObj(op.id);if(op.selectNode){var sNode=zTree.getNodeByParam(op.idKey,op.selectNode);if(sNode){zTree.selectNode(sNode);if(!sNode.open){zTree.expandNode(sNode);}}}});}});})(jQuery);


